<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyMaster - Educational Learning App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stats-bar {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 10px;
            color: white;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.9);
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .content-area {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            min-height: 400px;
        }

        .flashcard {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 20px;
        }

        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .flashcard h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .flashcard p {
            font-size: 1.2rem;
            line-height: 1.6;
        }

        .quiz-question {
            margin-bottom: 30px;
        }

        .quiz-question h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #333;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .quiz-option {
            display: block !important;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            color: #333;
            font-size: 1rem;
            text-align: left;
            width: 100%;
            box-sizing: border-box;
        }

        .quiz-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .quiz-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .quiz-option.correct {
            border-color: #4caf50;
            background: #e8f5e8;
            color: #2e7d32;
        }

        .quiz-option.incorrect {
            border-color: #f44336;
            background: #ffebee;
            color: #c62828;
        }

        .timer {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
        }

        .timer.warning {
            color: #f44336;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .results {
            text-align: center;
            padding: 30px;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            transition: width 0.5s ease;
        }

        .hidden {
            display: none;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active {
            background: #667eea;
            color: white;
        }

        .streak-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: achievementPop 0.5s ease-out;
        }

        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .study-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin: 10px 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f5f5f5;
            color: #666;
            border: 2px solid transparent;
            min-height: 40px;
        }

        .calendar-day:hover {
            background: #e8f4fd;
            color: #333;
        }

        .calendar-day.studied {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            border-color: #4caf50;
        }

        .calendar-day.today {
            border: 3px solid #667eea;
            font-weight: bold;
            background: #fff;
            color: #667eea;
        }

        .calendar-day.today.studied {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            color: white;
            border-color: #667eea;
        }

        .calendar-day.planned {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .voice-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .voice-controls:hover {
            transform: scale(1.1);
        }

        .voice-controls.listening {
            background: linear-gradient(135deg, #f44336 0%, #ff6b6b 100%);
            animation: pulse 1s infinite;
        }

        .leaderboard {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .study-notes {
            background: #fff9c4;
            border-left: 4px solid #ffd700;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 20px auto;
        }

        .progress-ring-circle {
            fill: none;
            stroke: #e0e0e0;
            stroke-width: 8;
        }

        .progress-ring-progress {
            fill: none;
            stroke: #667eea;
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dasharray 0.5s ease;
        }

        .dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            color: white;
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .mode-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö StudyMaster</h1>
            <p>Master your subjects with interactive learning</p>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalScore">0</div>
                <div>Total Score</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="averageScore">0%</div>
                <div>Average</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="streakCount">0</div>
                <div>Best Streak</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalAttempts">0</div>
                <div>Attempts</div>
            </div>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="switchMode('flashcards')">üÉè Flashcards</button>
            <button class="mode-btn" onclick="switchMode('quiz')">‚è± Timed Quiz</button>
            <button class="mode-btn" onclick="switchMode('practice')">üéØ Practice Mode</button>
            <button class="mode-btn" onclick="switchMode('review')">üìä Review Mistakes</button>
            <button class="mode-btn" onclick="switchMode('challenge')">‚ö° Daily Challenge</button>
            <button class="mode-btn" onclick="switchMode('study-plan')">üìÖ Study Planner</button>
        </div>

        <div class="content-area">
            <!-- Flashcard Mode -->
            <div id="flashcard-mode">
                <div class="difficulty-selector">
                    <button class="difficulty-btn active" onclick="setDifficulty('easy')">Easy</button>
                    <button class="difficulty-btn" onclick="setDifficulty('medium')">Medium</button>
                    <button class="difficulty-btn" onclick="setDifficulty('hard')">Hard</button>
                </div>
                
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-front">
                        <h3>Question</h3>
                        <p id="flashcard-question">Click "Next Card" to start studying!</p>
                    </div>
                    <div class="flashcard-back">
                        <h3>Answer</h3>
                        <p id="flashcard-answer">Answer will appear here</p>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-secondary" onclick="previousCard()">‚¨Ö Previous</button>
                    <button class="btn btn-primary" onclick="flipCard()">üîÑ Flip Card</button>
                    <button class="btn btn-primary" onclick="nextCard()">Next ‚û°</button>
                    <button class="btn btn-success" onclick="markKnown()">‚úÖ I Know This</button>
                </div>
            </div>

            <!-- Quiz Mode -->
            <div id="quiz-mode" class="hidden">
                <div class="timer" id="timer">5:00</div>
                
                <div class="quiz-question">
                    <h3 id="quiz-question-text">Ready to start your timed quiz?</h3>
                    <div class="quiz-options" id="quiz-options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="quiz-progress" style="width: 0%"></div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="quiz-start-btn" onclick="startQuiz()">üöÄ Start Quiz</button>
                    <button class="btn btn-secondary hidden" id="quiz-next-btn" onclick="nextQuestion()">Next Question</button>
                    <button class="btn btn-success hidden" id="quiz-finish-btn" onclick="finishQuiz()">Finish Quiz</button>
                </div>
            </div>

            <!-- Practice Mode -->
            <div id="practice-mode" class="hidden">
                <div class="quiz-question">
                    <h3 id="practice-question-text">Practice Mode - No Time Pressure!</h3>
                    <div class="quiz-options" id="practice-options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" onclick="startPractice()">üéØ Start Practice</button>
                    <button class="btn btn-secondary" onclick="nextPracticeQuestion()">Next Question</button>
                    <button class="btn btn-success" onclick="showPracticeAnswer()">Show Answer</button>
                </div>
            </div>

            <!-- Review Mode -->
            <div id="review-mode" class="hidden">
                <div class="results">
                    <h2>üìä Your Learning Analytics</h2>
                    <div id="review-content">
                        <p>Complete some quizzes to see your performance analytics!</p>
                    </div>
                </div>
            </div>

            <!-- Daily Challenge Mode -->
            <div id="challenge-mode" class="hidden">
                <div class="results">
                    <h2>‚ö° Daily Challenge</h2>
                    <div class="progress-ring">
                        <svg width="120" height="120">
                            <circle class="progress-ring-circle" cx="60" cy="60" r="52"></circle>
                            <circle class="progress-ring-progress" cx="60" cy="60" r="52" id="challenge-progress"></circle>
                        </svg>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: bold;">
                            <span id="challenge-score">0/5</span>
                        </div>
                    </div>
                    <p id="challenge-description">Complete 5 questions from different difficulty levels!</p>
                    <div id="challenge-content">
                        <div class="quiz-question">
                            <h3 id="challenge-question-text">Ready for today's challenge?</h3>
                            <div class="quiz-options" id="challenge-options"></div>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="btn btn-primary" id="start-challenge-btn" onclick="startDailyChallenge()">üöÄ Start Challenge</button>
                        <button class="btn btn-secondary hidden" id="next-challenge-btn" onclick="nextChallengeQuestion()">Next Question</button>
                    </div>
                </div>
            </div>

            <!-- Study Planner Mode -->
            <div id="study-plan-mode" class="hidden">
                <div class="results">
                    <h2 style="color: #333; margin-bottom: 30px;">üìÖ Study Planner</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 20px 0;">
                        <div>
                            <h3 style="color: #333; margin-bottom: 15px;">üìä This Week's Progress</h3>
                            <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-bottom: 10px;">
                                    <div style="text-align: center; font-weight: bold; color: #666; padding: 5px;">Sun</div>
                                    <div style="text-align: center; font-weight: bold; color: #666; padding: 5px;">Mon</div>
                                    <div style="text-align: center; font-weight: bold; color: #666; padding: 5px;">Tue</div>
                                    <div style="text-align: center; font-weight: bold; color: #666; padding: 5px;">Wed</div>
                                    <div style="text-align: center; font-weight: bold; color: #666; padding: 5px;">Thu</div>
                                    <div style="text-align: center; font-weight: bold; color: #666; padding: 5px;">Fri</div>
                                    <div style="text-align: center; font-weight: bold; color: #666; padding: 5px;">Sat</div>
                                </div>
                                <div class="study-calendar" id="study-calendar"></div>
                            </div>
                            <div class="study-notes" style="background: #fff9c4; border-left: 4px solid #ffd700; padding: 20px; border-radius: 10px;">
                                <h4 style="color: #333; margin-bottom: 15px;">üìù Study Notes</h4>
                                <textarea id="study-notes-input" placeholder="Add your study notes here..." style="width: 100%; height: 120px; border: 2px solid #ddd; background: white; resize: vertical; padding: 10px; border-radius: 8px; font-family: inherit; color: #333;"></textarea>
                                <button class="btn btn-primary" onclick="saveStudyNote()" style="margin-top: 15px;">üíæ Save Note</button>
                                <div id="saved-notes" style="margin-top: 15px;"></div>
                            </div>
                        </div>
                        <div>
                            <h3 style="color: #333; margin-bottom: 15px;">üèÜ Leaderboard</h3>
                            <div class="leaderboard" style="background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                <div class="leaderboard-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 8px 0; background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%); border-radius: 10px; color: #333; font-weight: bold;">
                                    <span>ü•á You</span>
                                    <span id="user-rank-score">0 pts</span>
                                </div>
                                <div class="leaderboard-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 8px 0; background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%); border-radius: 10px; color: #333;">
                                    <span>ü•à Alex</span>
                                    <span>850 pts</span>
                                </div>
                                <div class="leaderboard-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 8px 0; background: linear-gradient(135deg, #cd7f32 0%, #daa520 100%); border-radius: 10px; color: white;">
                                    <span>ü•â Sarah</span>
                                    <span>720 pts</span>
                                </div>
                                <div class="leaderboard-item" style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 8px 0; background: #f5f5f5; border-radius: 10px; color: #333;">
                                    <span>4Ô∏è‚É£ Mike</span>
                                    <span>680 pts</span>
                                </div>
                            </div>
                            <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                                <h4 style="color: #333; margin-bottom: 15px;">üéØ Study Goals</h4>
                                <div style="background: #f8f9ff; padding: 20px; border-radius: 10px; margin: 15px 0; border: 2px solid #667eea;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px; color: #333; font-weight: bold;">
                                        <span>Daily Study Streak</span>
                                        <span id="daily-goal-progress">0/7 days</span>
                                    </div>
                                    <div class="progress-bar" style="background: #e0e0e0; height: 25px; border-radius: 12px;">
                                        <div class="progress-fill" id="daily-goal-bar" style="width: 0%; height: 100%; background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); border-radius: 12px; transition: width 0.5s ease;"></div>
                                    </div>
                                </div>
                                <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-top: 15px; border: 2px solid #4facfe;">
                                    <h5 style="color: #333; margin-bottom: 10px;">üìà Weekly Target</h5>
                                    <p style="color: #666; margin: 0;">Study for at least 30 minutes each day this week to unlock bonus points!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="hidden">
                <div class="results">
                    <h2>üéâ Quiz Complete!</h2>
                    <div class="score-display" id="final-score">0/0</div>
                    <div id="score-percentage">0%</div>
                    <div id="time-taken">Time: 0:00</div>
                    
                    <div id="quiz-review">
                        <!-- Detailed results will be shown here -->
                    </div>
                    
                    <div class="controls">
                        <button class="btn btn-primary" onclick="retakeQuiz()">üîÑ Retake Quiz</button>
                        <button class="btn btn-secondary" onclick="switchMode('flashcards')">üìö Study More</button>
                        <button class="btn btn-success" onclick="switchMode('review')">üìä View Analytics</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="streak-indicator" id="streak-indicator">
            üî• Current Streak: <span id="current-streak">0</span>
        </div>

        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">üåô</button>
        <button class="voice-controls" onclick="toggleVoiceControl()" title="Voice Commands" id="voice-btn">üé§</button>

        <div id="achievement-popup" class="achievement-popup hidden">
            <h2 id="achievement-title">üèÜ Achievement Unlocked!</h2>
            <p id="achievement-description">You've earned a new badge!</p>
            <button class="btn btn-primary" onclick="closeAchievement()">Awesome!</button>
        </div>
    </div>

    <script>
        // Sample study data - in a real app, this would come from a database
        const studyData = {
            easy: [
                {
                    question: "What is the capital of France?",
                    answer: "Paris",
                    options: ["London", "Berlin", "Paris", "Madrid"],
                    correct: 2
                },
                {
                    question: "What is 2 + 2?",
                    answer: "4",
                    options: ["3", "4", "5", "6"],
                    correct: 1
                },
                {
                    question: "Which planet is closest to the Sun?",
                    answer: "Mercury",
                    options: ["Venus", "Mercury", "Earth", "Mars"],
                    correct: 1
                },
                {
                    question: "How many continents are there?",
                    answer: "7",
                    options: ["5", "6", "7", "8"],
                    correct: 2
                },
                {
                    question: "What color do you get when you mix red and blue?",
                    answer: "Purple",
                    options: ["Green", "Purple", "Orange", "Yellow"],
                    correct: 1
                },
                {
                    question: "Which animal is known as the King of the Jungle?",
                    answer: "Lion",
                    options: ["Tiger", "Lion", "Elephant", "Leopard"],
                    correct: 1
                },
                {
                    question: "How many days are in a leap year?",
                    answer: "366",
                    options: ["365", "366", "367", "364"],
                    correct: 1
                },
                {
                    question: "What is the largest ocean on Earth?",
                    answer: "Pacific Ocean",
                    options: ["Atlantic Ocean", "Pacific Ocean", "Indian Ocean", "Arctic Ocean"],
                    correct: 1
                }
            ],
            medium: [
                {
                    question: "What is the chemical symbol for gold?",
                    answer: "Au (from Latin 'aurum')",
                    options: ["Go", "Gd", "Au", "Ag"],
                    correct: 2
                },
                {
                    question: "Who wrote 'Romeo and Juliet'?",
                    answer: "William Shakespeare",
                    options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"],
                    correct: 1
                },
                {
                    question: "What is the square root of 144?",
                    answer: "12",
                    options: ["10", "12", "14", "16"],
                    correct: 1
                },
                {
                    question: "Which gas makes up most of Earth's atmosphere?",
                    answer: "Nitrogen",
                    options: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Hydrogen"],
                    correct: 1
                },
                {
                    question: "In which year was the first iPhone released?",
                    answer: "2007",
                    options: ["2005", "2007", "2008", "2006"],
                    correct: 1
                },
                {
                    question: "What is the capital of Australia?",
                    answer: "Canberra",
                    options: ["Sydney", "Melbourne", "Canberra", "Perth"],
                    correct: 2
                },
                {
                    question: "Which planet has the most moons?",
                    answer: "Saturn",
                    options: ["Jupiter", "Saturn", "Neptune", "Uranus"],
                    correct: 1
                },
                {
                    question: "What is the hardest natural substance on Earth?",
                    answer: "Diamond",
                    options: ["Gold", "Iron", "Diamond", "Platinum"],
                    correct: 2
                }
            ],
            hard: [
                {
                    question: "What is the powerhouse of the cell?",
                    answer: "Mitochondria - produces ATP energy for cellular processes",
                    options: ["Nucleus", "Ribosome", "Mitochondria", "Endoplasmic Reticulum"],
                    correct: 2
                },
                {
                    question: "In which year did World War II end?",
                    answer: "1945",
                    options: ["1944", "1945", "1946", "1947"],
                    correct: 1
                },
                {
                    question: "What is the derivative of x¬≤?",
                    answer: "2x",
                    options: ["x", "2x", "x¬≤", "2x¬≤"],
                    correct: 1
                },
                {
                    question: "Who developed the theory of relativity?",
                    answer: "Albert Einstein",
                    options: ["Isaac Newton", "Albert Einstein", "Galileo Galilei", "Stephen Hawking"],
                    correct: 1
                },
                {
                    question: "What is the pH of pure water?",
                    answer: "7",
                    options: ["6", "7", "8", "9"],
                    correct: 1
                },
                {
                    question: "Which programming language was created by Guido van Rossum?",
                    answer: "Python",
                    options: ["Java", "Python", "C++", "JavaScript"],
                    correct: 1
                },
                {
                    question: "What is the smallest unit of matter?",
                    answer: "Atom",
                    options: ["Molecule", "Atom", "Electron", "Proton"],
                    correct: 1
                },
                {
                    question: "In which year was the Berlin Wall torn down?",
                    answer: "1989",
                    options: ["1987", "1989", "1991", "1985"],
                    correct: 1
                }
            ]
        };

        // Shuffle array function
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Get randomized questions for quiz
        function getRandomizedQuestions(difficulty, count = null) {
            const questions = studyData[difficulty];
            const shuffled = shuffleArray(questions);
            return count ? shuffled.slice(0, count) : shuffled;
        }

        // App state
        let currentMode = 'flashcards';
        let currentDifficulty = 'easy';
        let currentCardIndex = 0;
        let currentQuizIndex = 0;
        let quizTimer = null;
        let quizTimeLeft = 300; // 5 minutes
        let quizAnswers = [];
        let isCardFlipped = false;
        let knownCards = new Set();
        let currentStreak = 0;
        let bestStreak = 0;
        let totalScore = 0;
        let totalAttempts = 0;
        let allScores = [];
        let wrongAnswers = [];
        let isDarkMode = false;
        let isVoiceEnabled = false;
        let voiceRecognition = null;
        let achievements = [];
        let studyNotes = [];
        let dailyChallengeCompleted = false;
        let challengeQuestions = [];
        let challengeIndex = 0;
        let challengeScore = 0;
        let studiedDays = new Set();
        let userPoints = 0;
        let currentQuizQuestions = []; // Store randomized questions for current quiz
        let currentPracticeQuestions = []; // Store randomized questions for practice
        let currentFlashcards = []; // Store randomized flashcards

        // Initialize app
        function init() {
            updateStats();
            loadFlashcard();
        }

        // Mode switching
        function switchMode(mode) {
            // Update active button
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all modes
            document.querySelectorAll('[id$="-mode"], #results-screen').forEach(el => el.classList.add('hidden'));
            
            // Show selected mode
            document.getElementById(mode + '-mode').classList.remove('hidden');
            currentMode = mode;
            
            if (mode === 'review') {
                showReviewMode();
            }
        }

        // Difficulty selection
        function setDifficulty(difficulty) {
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            currentDifficulty = difficulty;
            currentCardIndex = 0;
            currentFlashcards = []; // Reset to get new random order
            loadFlashcard();
        }

        // Flashcard functions
        function loadFlashcard() {
            // Get randomized cards for current difficulty if not already set
            if (!currentFlashcards || currentFlashcards.length === 0) {
                currentFlashcards = getRandomizedQuestions(currentDifficulty);
            }
            
            if (currentFlashcards.length === 0) return;
            
            const card = currentFlashcards[currentCardIndex];
            document.getElementById('flashcard-question').textContent = card.question;
            document.getElementById('flashcard-answer').textContent = card.answer;
            
            // Reset flip state
            document.getElementById('flashcard').classList.remove('flipped');
            isCardFlipped = false;
        }

        function flipCard() {
            const flashcard = document.getElementById('flashcard');
            flashcard.classList.toggle('flipped');
            isCardFlipped = !isCardFlipped;
        }

        function nextCard() {
            if (!currentFlashcards || currentFlashcards.length === 0) {
                currentFlashcards = getRandomizedQuestions(currentDifficulty);
            }
            currentCardIndex = (currentCardIndex + 1) % currentFlashcards.length;
            loadFlashcard();
        }

        function previousCard() {
            if (!currentFlashcards || currentFlashcards.length === 0) {
                currentFlashcards = getRandomizedQuestions(currentDifficulty);
            }
            currentCardIndex = currentCardIndex === 0 ? currentFlashcards.length - 1 : currentCardIndex - 1;
            loadFlashcard();
        }

        function markKnown() {
            const cardKey = ${currentDifficulty}-${currentCardIndex};
            knownCards.add(cardKey);
            currentStreak++;
            if (currentStreak > bestStreak) {
                bestStreak = currentStreak;
            }
            updateStats();
            nextCard();
        }

        // Quiz functions
        function startQuiz() {
            currentQuizIndex = 0;
            quizAnswers = [];
            quizTimeLeft = 300;
            wrongAnswers = [];
            
            // Get randomized questions for this quiz session
            currentQuizQuestions = getRandomizedQuestions(currentDifficulty);
            
            document.getElementById('quiz-start-btn').classList.add('hidden');
            document.getElementById('quiz-next-btn').classList.remove('hidden');
            
            startTimer();
            loadQuizQuestion();
        }

        function startTimer() {
            const timerElement = document.getElementById('timer');
            quizTimer = setInterval(() => {
                quizTimeLeft--;
                const minutes = Math.floor(quizTimeLeft / 60);
                const seconds = quizTimeLeft % 60;
                timerElement.textContent = ${minutes}:${seconds.toString().padStart(2, '0')};
                
                if (quizTimeLeft <= 30) {
                    timerElement.classList.add('warning');
                }
                
                if (quizTimeLeft <= 0) {
                    finishQuiz();
                }
            }, 1000);
        }

        function loadQuizQuestion() {
            if (currentQuizIndex >= currentQuizQuestions.length) {
                finishQuiz();
                return;
            }
            
            const question = currentQuizQuestions[currentQuizIndex];
            document.getElementById('quiz-question-text').textContent = Question ${currentQuizIndex + 1}: ${question.question};
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.style.display = 'block';
                optionElement.style.margin = '10px 0';
                optionElement.onclick = () => selectQuizOption(index, optionElement);
                optionsContainer.appendChild(optionElement);
            });
            
            // Update progress
            const progress = ((currentQuizIndex + 1) / currentQuizQuestions.length) * 100;
            document.getElementById('quiz-progress').style.width = progress + '%';
            
            // Show finish button on last question
            if (currentQuizIndex === currentQuizQuestions.length - 1) {
                document.getElementById('quiz-next-btn').classList.add('hidden');
                document.getElementById('quiz-finish-btn').classList.remove('hidden');
            }
        }

        function selectQuizOption(selectedIndex, optionElement) {
            // Remove previous selections
            document.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
            optionElement.classList.add('selected');
            
            // Store answer
            quizAnswers[currentQuizIndex] = selectedIndex;
        }

        function nextQuestion() {
            if (quizAnswers[currentQuizIndex] === undefined) {
                alert('Please select an answer before continuing!');
                return;
            }
            
            currentQuizIndex++;
            loadQuizQuestion();
        }

        function finishQuiz() {
            clearInterval(quizTimer);
            
            // Calculate score
            let correctAnswers = 0;
            
            currentQuizQuestions.forEach((question, index) => {
                if (quizAnswers[index] === question.correct) {
                    correctAnswers++;
                } else {
                    wrongAnswers.push({
                        question: question.question,
                        userAnswer: question.options[quizAnswers[index]] || 'No answer',
                        correctAnswer: question.options[question.correct],
                        explanation: question.answer
                    });
                }
            });
            
            const score = correctAnswers;
            const percentage = Math.round((correctAnswers / currentQuizQuestions.length) * 100);
            const timeTaken = 300 - quizTimeLeft;
            
            // Update stats
            totalScore += score;
            totalAttempts++;
            allScores.push(percentage);
            
            if (percentage === 100) {
                currentStreak++;
                if (currentStreak > bestStreak) {
                    bestStreak = currentStreak;
                }
            } else {
                currentStreak = 0;
            }
            
            updateStats();
            showResults(score, currentQuizQuestions.length, percentage, timeTaken);
        }

        function showResults(score, total, percentage, timeTaken) {
            // Hide quiz mode, show results
            document.getElementById('quiz-mode').classList.add('hidden');
            document.getElementById('results-screen').classList.remove('hidden');
            
            // Display results
            document.getElementById('final-score').textContent = ${score}/${total};
            document.getElementById('score-percentage').textContent = ${percentage}%;
            
            const minutes = Math.floor(timeTaken / 60);
            const seconds = timeTaken % 60;
            document.getElementById('time-taken').textContent = Time: ${minutes}:${seconds.toString().padStart(2, '0')};
            
            // Show detailed review
            const reviewContainer = document.getElementById('quiz-review');
            reviewContainer.innerHTML = '<h3>üìù Question Review</h3>';
            
            if (wrongAnswers.length > 0) {
                wrongAnswers.forEach(wrong => {
                    const reviewItem = document.createElement('div');
                    reviewItem.style.cssText = 'margin: 15px 0; padding: 15px; background: #ffebee; border-radius: 10px; text-align: left;';
                    reviewItem.innerHTML = `
                        <strong>‚ùå ${wrong.question}</strong><br>
                        <span style="color: #c62828;">Your answer: ${wrong.userAnswer}</span><br>
                        <span style="color: #2e7d32;">Correct answer: ${wrong.correctAnswer}</span><br>
                        <small style="color: #666;">${wrong.explanation}</small>
                    `;
                    reviewContainer.appendChild(reviewItem);
                });
            } else {
                reviewContainer.innerHTML += '<p style="color: #2e7d32; font-weight: bold;">üéâ Perfect score! You got all questions correct!</p>';
            }
        }

        function retakeQuiz() {
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('quiz-mode').classList.remove('hidden');
            
            // Reset quiz UI
            document.getElementById('quiz-start-btn').classList.remove('hidden');
            document.getElementById('quiz-next-btn').classList.add('hidden');
            document.getElementById('quiz-finish-btn').classList.add('hidden');
            document.getElementById('timer').classList.remove('warning');
            document.getElementById('timer').textContent = '5:00';
            document.getElementById('quiz-progress').style.width = '0%';
            document.getElementById('quiz-question-text').textContent = 'Ready to start your timed quiz?';
            document.getElementById('quiz-options').innerHTML = '';
        }

        // Practice mode functions
        function startPractice() {
            currentQuizIndex = 0;
            // Get randomized questions for practice session
            currentPracticeQuestions = getRandomizedQuestions(currentDifficulty);
            loadPracticeQuestion();
        }

        function loadPracticeQuestion() {
            if (!currentPracticeQuestions || currentPracticeQuestions.length === 0) {
                currentPracticeQuestions = getRandomizedQuestions(currentDifficulty);
            }
            
            if (currentQuizIndex >= currentPracticeQuestions.length) {
                currentQuizIndex = 0;
            }
            
            const question = currentPracticeQuestions[currentQuizIndex];
            document.getElementById('practice-question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('practice-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.onclick = () => selectPracticeOption(index, optionElement);
                optionsContainer.appendChild(optionElement);
            });
        }

        function selectPracticeOption(selectedIndex, optionElement) {
            document.querySelectorAll('#practice-options .quiz-option').forEach(opt => {
                opt.classList.remove('selected', 'correct', 'incorrect');
            });
            optionElement.classList.add('selected');
        }

        function showPracticeAnswer() {
            const question = currentPracticeQuestions[currentQuizIndex];
            const options = document.querySelectorAll('#practice-options .quiz-option');
            
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (option.classList.contains('selected')) {
                    option.classList.add('incorrect');
                }
            });
        }

        function nextPracticeQuestion() {
            currentQuizIndex++;
            loadPracticeQuestion();
        }

        // Review mode
        function showReviewMode() {
            const reviewContent = document.getElementById('review-content');
            
            if (allScores.length === 0 && wrongAnswers.length === 0) {
                reviewContent.innerHTML = `
                    <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <div style="font-size: 4rem; margin-bottom: 20px;">üìö</div>
                        <h3 style="color: #333; margin-bottom: 15px;">No Data Yet</h3>
                        <p style="color: #666; margin-bottom: 20px;">Complete some quizzes to see your performance analytics and review mistakes!</p>
                        <button class="btn btn-primary" onclick="switchMode('quiz')" style="margin: 10px;">Take a Quiz</button>
                        <button class="btn btn-secondary" onclick="switchMode('practice')" style="margin: 10px;">Practice Mode</button>
                    </div>
                `;
                return;
            }
            
            const averageScore = allScores.length > 0 ? Math.round(allScores.reduce((a, b) => a + b, 0) / allScores.length) : 0;
            const highestScore = allScores.length > 0 ? Math.max(...allScores) : 0;
            const lowestScore = allScores.length > 0 ? Math.min(...allScores) : 0;
            
            reviewContent.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                        <h3>üìä Average Score</h3>
                        <div style="font-size: 2rem; font-weight: bold;">${averageScore}%</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); color: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                        <h3>üèÜ Highest Score</h3>
                        <div style="font-size: 2rem; font-weight: bold;">${highestScore}%</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                        <h3>üìà Improvement</h3>
                        <div style="font-size: 2rem; font-weight: bold;">${Math.max(0, highestScore - lowestScore)}%</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%); color: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                        <h3>‚ùå Mistakes</h3>
                        <div style="font-size: 2rem; font-weight: bold;">${wrongAnswers.length}</div>
                    </div>
                </div>
                
                ${wrongAnswers.length > 0 ? `
                <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                    <h3 style="color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span style="background: #ff6b6b; color: white; padding: 8px 12px; border-radius: 50%; font-size: 1rem;">‚ùå</span>
                        Review Your Mistakes
                    </h3>
                    <div style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
                        ${wrongAnswers.map((wrong, index) => `
                            <div style="margin: 15px 0; padding: 20px; background: #fff5f5; border-left: 4px solid #ff6b6b; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                    <span style="background: #ff6b6b; color: white; padding: 4px 8px; border-radius: 50%; font-size: 0.8rem; font-weight: bold;">${index + 1}</span>
                                    <strong style="color: #333; font-size: 1.1rem;">${wrong.question}</strong>
                                </div>
                                <div style="margin-left: 30px;">
                                    <div style="margin: 8px 0; padding: 10px; background: #ffebee; border-radius: 8px;">
                                        <span style="color: #c62828; font-weight: bold;">Your answer: </span>
                                        <span style="color: #c62828;">${wrong.userAnswer}</span>
                                    </div>
                                    <div style="margin: 8px 0; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                                        <span style="color: #2e7d32; font-weight: bold;">Correct answer: </span>
                                        <span style="color: #2e7d32;">${wrong.correctAnswer}</span>
                                    </div>
                                    <div style="margin: 8px 0; padding: 10px; background: #f0f8ff; border-radius: 8px;">
                                        <span style="color: #1976d2; font-weight: bold;">Explanation: </span>
                                        <span style="color: #666;">${wrong.explanation}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="clearMistakes()" style="margin: 5px;">üóë Clear Mistakes</button>
                        <button class="btn btn-secondary" onclick="practiceWrongAnswers()" style="margin: 5px;">üéØ Practice These</button>
                    </div>
                </div>
                ` : `
                <div style="background: white; padding: 25px; border-radius: 15px; margin: 20px 0; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                    <div style="font-size: 3rem; margin-bottom: 15px;">üéâ</div>
                    <h3 style="color: #333; margin-bottom: 10px;">Perfect Performance!</h3>
                    <p style="color: #666;">You haven't made any mistakes yet. Keep up the great work!</p>
                </div>
                `}
                
                <div style="background: white; padding: 25px; border-radius: 15px; margin-top: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                    <h3 style="color: #333; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="background: #667eea; color: white; padding: 8px 12px; border-radius: 50%; font-size: 1rem;">üí°</span>
                        Study Recommendations
                    </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        <div style="background: #f8f9ff; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
                            <h4 style="color: #333; margin-bottom: 8px;">üìö Focus Areas</h4>
                            <p style="color: #666; margin: 0; font-size: 0.9rem;">Focus on ${currentDifficulty} level questions to build confidence</p>
                        </div>
                        <div style="background: #f0f8ff; padding: 15px; border-radius: 10px; border-left: 4px solid #4facfe;">
                            <h4 style="color: #333; margin-bottom: 8px;">üÉè Flashcards</h4>
                            <p style="color: #666; margin: 0; font-size: 0.9rem;">Review flashcards for topics you got wrong in quizzes</p>
                        </div>
                        <div style="background: #fff9e6; padding: 15px; border-radius: 10px; border-left: 4px solid #ffd700;">
                            <h4 style="color: #333; margin-bottom: 8px;">üî• Streak Goal</h4>
                            <p style="color: #666; margin: 0; font-size: 0.9rem;">Try to maintain a study streak of at least 7 days</p>
                        </div>
                        <div style="background: #f0fff0; padding: 15px; border-radius: 10px; border-left: 4px solid #56ab2f;">
                            <h4 style="color: #333; margin-bottom: 8px;">üéØ Practice Mode</h4>
                            <p style="color: #666; margin: 0; font-size: 0.9rem;">Use practice mode to reinforce learning without time pressure</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function clearMistakes() {
            if (confirm('Are you sure you want to clear all mistake records?')) {
                wrongAnswers = [];
                showReviewMode();
                alert('Mistake records cleared!');
            }
        }
        
        function practiceWrongAnswers() {
            if (wrongAnswers.length === 0) {
                alert('No mistakes to practice!');
                return;
            }
            
            // Switch to practice mode and load questions from mistakes
            switchMode('practice');
            alert('Practice mode loaded with your mistake topics!');
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalScore').textContent = totalScore;
            document.getElementById('averageScore').textContent = totalAttempts > 0 ? 
                Math.round(allScores.reduce((a, b) => a + b, 0) / allScores.length) + '%' : '0%';
            document.getElementById('streakCount').textContent = bestStreak;
            document.getElementById('totalAttempts').textContent = totalAttempts;
            document.getElementById('current-streak').textContent = currentStreak;
        }

        // New Features Functions

        // Theme Toggle
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            document.querySelector('.theme-toggle').textContent = isDarkMode ? '‚òÄ' : 'üåô';
        }

        // Voice Control
        function toggleVoiceControl() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Voice recognition not supported in this browser');
                return;
            }

            isVoiceEnabled = !isVoiceEnabled;
            const voiceBtn = document.getElementById('voice-btn');
            
            if (isVoiceEnabled) {
                voiceBtn.classList.add('listening');
                startVoiceRecognition();
            } else {
                voiceBtn.classList.remove('listening');
                if (voiceRecognition) {
                    voiceRecognition.stop();
                }
            }
        }

        function startVoiceRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            voiceRecognition = new SpeechRecognition();
            voiceRecognition.continuous = true;
            voiceRecognition.interimResults = false;

            voiceRecognition.onresult = function(event) {
                const command = event.results[event.results.length - 1][0].transcript.toLowerCase();
                handleVoiceCommand(command);
            };

            voiceRecognition.start();
        }

        function handleVoiceCommand(command) {
            if (command.includes('next card') || command.includes('next')) {
                nextCard();
            } else if (command.includes('flip card') || command.includes('flip')) {
                flipCard();
            } else if (command.includes('quiz') || command.includes('start quiz')) {
                switchMode('quiz');
            } else if (command.includes('flashcards') || command.includes('cards')) {
                switchMode('flashcards');
            } else if (command.includes('practice')) {
                switchMode('practice');
            }
        }

        // Achievement System
        function checkAchievements() {
            const newAchievements = [];
            
            if (currentStreak >= 5 && !achievements.includes('streak5')) {
                newAchievements.push({
                    id: 'streak5',
                    title: 'Hot Streak!',
                    description: 'Maintained a 5-day study streak!'
                });
                achievements.push('streak5');
            }
            
            if (totalAttempts >= 10 && !achievements.includes('attempts10')) {
                newAchievements.push({
                    id: 'attempts10',
                    title: 'Dedicated Learner',
                    description: 'Completed 10 quiz attempts!'
                });
                achievements.push('attempts10');
            }
            
            if (allScores.some(score => score === 100) && !achievements.includes('perfect')) {
                newAchievements.push({
                    id: 'perfect',
                    title: 'Perfect Score!',
                    description: 'Achieved 100% on a quiz!'
                });
                achievements.push('perfect');
            }

            newAchievements.forEach(achievement => {
                showAchievement(achievement);
                userPoints += 50;
            });
        }

        function showAchievement(achievement) {
            document.getElementById('achievement-title').textContent = üèÜ ${achievement.title};
            document.getElementById('achievement-description').textContent = achievement.description;
            document.getElementById('achievement-popup').classList.remove('hidden');
            
            setTimeout(() => {
                closeAchievement();
            }, 3000);
        }

        function closeAchievement() {
            document.getElementById('achievement-popup').classList.add('hidden');
